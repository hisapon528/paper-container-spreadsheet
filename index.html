<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ç´™å®¹å™¨ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ï¼ˆa,b,Vé€£å‹•ç‰ˆï¼‰</title>
<style>
  body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    padding: 20px;
    max-width: 900px;
    margin: auto;
  }
  h1 {
    font-size: 22px;
    margin-bottom: 8px;
  }
  .formula {
    font-family: "Cambria Math", "Times New Roman", serif;
    font-size: 28px;
    margin-bottom: 16px;
  }
  .section {
    border: 1px solid #ddd;
    border-radius: 10px;
    padding: 12px 16px;
    margin-bottom: 20px;
  }
  table {
    border-collapse: collapse;
    width: 100%;
  }
  th, td {
    border: 1px solid #ccc;
    padding: 6px 8px;
    text-align: center;
  }
  th {
    background-color: #f5f5f5;
  }
  input[type="number"] {
    width: 100%;
    box-sizing: border-box;
    padding: 4px 6px;
    text-align: right;
  }
  button {
    padding: 6px 10px;
    cursor: pointer;
    border-radius: 6px;
    border: 1px solid #888;
    background: #f3f3f3;
  }
  button.fixed {
    background: #0078d4;
    color: white;
    border-color: #005a9e;
  }
  #fixed-info {
    font-size: 14px;
    margin-top: 6px;
    color: #333;
  }
  #message {
    margin-top: 6px;
    font-size: 13px;
    color: #c00;
  }
  #save-btn {
    margin-top: 10px;
  }
</style>
</head>
<body>

<h1>ğŸ“¦ ç´™å®¹å™¨ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼</h1>
<div class="formula">\( V = a(21 - 2b)b \)</div>

<div class="section">
  <h2>å…¥åŠ›ã‚¨ãƒªã‚¢ï¼ˆExcelé¢¨ï¼‰</h2>
  <p>â€» ã„ã¤ã‚‚ <strong>1ã¤ã ã‘ã€Œå›ºå®šã€</strong> ãŒé¸ã°ã‚Œã¾ã™ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯ V = 220 å›ºå®šï¼‰ã€‚<br>
  å›ºå®šã•ã‚Œã¦ã„ãªã„ 2ã¤ã®ã†ã¡ã€ã©ã¡ã‚‰ã‹ã‚’å¤‰æ›´ã™ã‚‹ã¨ã€æ®‹ã‚Š1ã¤ãŒè‡ªå‹•çš„ã«è¨ˆç®—ã•ã‚Œã¾ã™ã€‚</p>

  <table>
    <thead>
      <tr>
        <th>å¤‰æ•°</th>
        <th>å€¤</th>
        <th>å›ºå®š</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <th>aï¼ˆåº•é¢ã®æ¨ªï¼‰</th>
        <td><input id="input-a" type="number" step="0.001" min="0" oninput="handleInput('a')"></td>
        <td><button id="btn-fixed-a" onclick="setFixed('a')">å›ºå®š</button></td>
      </tr>
      <tr>
        <th>bï¼ˆé«˜ã•ï¼‰</th>
        <td><input id="input-b" type="number" step="0.001" min="0" oninput="handleInput('b')"></td>
        <td><button id="btn-fixed-b" onclick="setFixed('b')">å›ºå®š</button></td>
      </tr>
      <tr>
        <th>Vï¼ˆä½“ç©ï¼‰</th>
        <td><input id="input-v" type="number" step="0.001" min="0" oninput="handleInput('V')"></td>
        <td><button id="btn-fixed-v" onclick="setFixed('V')">å›ºå®š</button></td>
      </tr>
    </tbody>
  </table>

  <div id="fixed-info"></div>
  <div id="message"></div>

  <button id="save-btn" onclick="saveCurrent()">ä¿å­˜ã™ã‚‹</button>
</div>

<div class="section">
  <h2>ä¿å­˜ã•ã‚ŒãŸçµ„ã¿åˆã‚ã›</h2>
  <table id="saved-table">
    <thead>
      <tr>
        <th>#</th>
        <th>a</th>
        <th>b</th>
        <th>V</th>
      </tr>
    </thead>
    <tbody>
      <!-- ã“ã“ã«è¡ŒãŒè¿½åŠ ã•ã‚Œã‚‹ -->
    </tbody>
  </table>
</div>

<script>
  // çŠ¶æ…‹ç®¡ç†
  let fixedVar = 'V'; // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ V ã‚’å›ºå®š
  let saveCount = 0;

  const inputA = document.getElementById('input-a');
  const inputB = document.getElementById('input-b');
  const inputV = document.getElementById('input-v');

  const btnFixedA = document.getElementById('btn-fixed-a');
  const btnFixedB = document.getElementById('btn-fixed-b');
  const btnFixedV = document.getElementById('btn-fixed-v');

  const fixedInfo = document.getElementById('fixed-info');
  const message = document.getElementById('message');
  const savedTableBody = document.querySelector('#saved-table tbody');

  function setMessage(text) {
    message.textContent = text || '';
  }

  function updateFixedDisplay() {
    btnFixedA.classList.toggle('fixed', fixedVar === 'a');
    btnFixedB.classList.toggle('fixed', fixedVar === 'b');
    btnFixedV.classList.toggle('fixed', fixedVar === 'V');
    fixedInfo.textContent = `ç¾åœ¨ å›ºå®šã•ã‚Œã¦ã„ã‚‹å¤‰æ•°ï¼š${fixedVar}`;
  }

  function setFixed(v) {
    fixedVar = v;
    updateFixedDisplay();
    setMessage('');
  }

  // äºŒæ¬¡æ–¹ç¨‹å¼ã‹ã‚‰ b ã‚’æ±‚ã‚ã‚‹ï¼ˆV = a(21 - 2b)bï¼‰
  function solveBFromAV(a, V) {
    if (a === 0) return null;
    const D = 441 * a * a - 8 * a * V; // åˆ¤åˆ¥å¼
    if (D < 0) return null;
    const sqrtD = Math.sqrt(D);
    const b1 = (21 * a + sqrtD) / (4 * a);
    const b2 = (21 * a - sqrtD) / (4 * a);
    const candidates = [b1, b2].filter(b => b > 0 && b < 10.5);
    if (candidates.length === 0) return null;
    // å°ã•ã„æ–¹ã‚’æ¡ç”¨
    return Math.min.apply(null, candidates);
  }

  function handleInput(changed) {
    setMessage('');

    const aVal = parseFloat(inputA.value);
    const bVal = parseFloat(inputB.value);
    const vVal = parseFloat(inputV.value);

    let a = isNaN(aVal) ? 0 : aVal;
    let b = isNaN(bVal) ? 0 : bVal;
    let V = isNaN(vVal) ? 0 : vVal;

    try {
      if (fixedVar === 'V') {
        // V ã‚’ä¿ã£ãŸã¾ã¾ a,b ã‚’èª¿æ•´
        if (changed === 'a') {
          const newB = solveBFromAV(a, V);
          if (newB === null) throw new Error('ãã® a ã¨ V ã®çµ„ã§ã¯ b ãŒæ±‚ã¾ã‚Šã¾ã›ã‚“ã€‚');
          b = newB;
          inputB.value = b.toFixed(3);
        } else if (changed === 'b') {
          const denom = (21 - 2 * b) * b;
          if (denom <= 0) throw new Error('b ã®å€¤ãŒæ¡ä»¶ã«åˆã„ã¾ã›ã‚“ã€‚');
          a = V / denom;
          if (a <= 0 || a > 8.7) throw new Error('ãã® b ã¨ V ã®çµ„ã§ã¯ a ãŒæ¡ä»¶ã‚’æº€ãŸã—ã¾ã›ã‚“ã€‚');
          inputA.value = a.toFixed(3);
        } else if (changed === 'V') {
          // å›ºå®šå¤‰æ•°è‡ªä½“ã‚’å¤‰ãˆãŸã¨ãã¯ã€b ã‹ã‚‰ a ã‚’å†è¨ˆç®—
          const denom = (21 - 2 * b) * b;
          if (denom <= 0) throw new Error('b ã®å€¤ãŒæ¡ä»¶ã«åˆã„ã¾ã›ã‚“ã€‚');
          a = V / denom;
          if (a <= 0 || a > 8.7) throw new Error('ãã® b ã¨ V ã®çµ„ã§ã¯ a ãŒæ¡ä»¶ã‚’æº€ãŸã—ã¾ã›ã‚“ã€‚');
          inputA.value = a.toFixed(3);
        }
      } else if (fixedVar === 'a') {
        if (changed === 'b') {
          V = a * (21 - 2 * b) * b;
          inputV.value = V.toFixed(3);
        } else if (changed === 'V') {
          const newB = solveBFromAV(a, V);
          if (newB === null) throw new Error('ãã® a ã¨ V ã®çµ„ã§ã¯ b ãŒæ±‚ã¾ã‚Šã¾ã›ã‚“ã€‚');
          b = newB;
          inputB.value = b.toFixed(3);
        } else if (changed === 'a') {
          // a ã‚’å¤‰ãˆãŸã¨ãã¯ã€ç¾åœ¨ã® b ã‹ã‚‰ V ã‚’å†è¨ˆç®—
          V = a * (21 - 2 * b) * b;
          inputV.value = V.toFixed(3);
        }
      } else if (fixedVar === 'b') {
        if (changed === 'a') {
          V = a * (21 - 2 * b) * b;
          inputV.value = V.toFixed(3);
        } else if (changed === 'V') {
          const denom = (21 - 2 * b) * b;
          if (denom <= 0) throw new Error('b ã®å€¤ãŒæ¡ä»¶ã«åˆã„ã¾ã›ã‚“ã€‚');
          a = V / denom;
          if (a <= 0 || a > 8.7) throw new Error('ãã® b ã¨ V ã®çµ„ã§ã¯ a ãŒæ¡ä»¶ã‚’æº€ãŸã—ã¾ã›ã‚“ã€‚');
          inputA.value = a.toFixed(3);
        } else if (changed === 'b') {
          V = a * (21 - 2 * b) * b;
          inputV.value = V.toFixed(3);
        }
      }
    } catch (e) {
      setMessage(e.message);
    }
  }

  function saveCurrent() {
    const aVal = parseFloat(inputA.value);
    const bVal = parseFloat(inputB.value);
    const vVal = parseFloat(inputV.value);
    if ([aVal, bVal, vVal].some(x => isNaN(x))) {
      setMessage('a, b, V ã®æ•°å€¤ãŒæƒã£ã¦ã„ã¾ã›ã‚“ã€‚');
      return;
    }
    saveCount += 1;
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${saveCount}</td>
      <td>${aVal.toFixed(3)}</td>
      <td>${bVal.toFixed(3)}</td>
      <td>${vVal.toFixed(3)}</td>
    `;
    savedTableBody.appendChild(tr);
    setMessage('');
  }

  // åˆæœŸå€¤è¨­å®šï¼ˆa=4, b=5, V=220 ã§ã‚¹ã‚¿ãƒ¼ãƒˆï¼‰
  function init() {
    const a0 = 4.0;
    const b0 = 5.0;
    const V0 = a0 * (21 - 2 * b0) * b0; // 220 ã«ãªã‚‹

    inputA.value = a0.toFixed(3);
    inputB.value = b0.toFixed(3);
    inputV.value = V0.toFixed(3);

    fixedVar = 'V';
    updateFixedDisplay();
    setMessage('');
  }

  init();
</script>
</body>
</html>
